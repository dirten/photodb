#!/usr/bin/perl -wT

# Interactive user interface for interacting with the photography database

use strict;
use warnings;
use Switch;
use DBI;
use DBD::mysql;
use SQL::Abstract;

use lib 'lib';
use funcs;
use queries;
use handlers;

# Connect to DB - for now this is a global
my $db = &db;

# Define handlers for each command
my %handlers = (
	'film' => {
		'add' => \&film_add,
		'load' => \&film_load,
		'develop' => \&film_develop,
		'tag' => \&film_tag,
		'archive' => \&film_archive,
		'locate' => \&film_locate
	},
	camera => {
		'add' => \&camera_add,
		'display-lens' => \&camera_displaylens,
		'show-lenses' => \&notimplemented,
		'sell' => \&camera_sell,
		'repair' => \&camera_repair,
		'addbodytype' => \&camera_addbodytype
	},
	negative => {
		'add' => \&negative_add,
		'bulk-add' => \&negative_bulkadd
	},
	mount => {
		'add' => \&mount_add,
		'view' => \&mount_view,
		'adapt' => \&mount_adapt
	},
	lens => {
		'add' => \&lens_add,
		'sell' => \&lens_sell,
		'repair' => \&lens_repair
	},
	print => {
		'add' => \&print_add,
		'tone' => \&print_tone,
		'sell' => \&print_sell,
		'order' => \&print_order,
		'fulfil' => \&print_fulfil,
		'archive' => \&print_archive,
		'locate' => \&print_locate
	},
	paperstock => {
		'add' => \&paperstock_add
	},
	developer => {
		'add' => \&developer_add
	},
	toner => {
		'add' => \&toner_add
	},
	task => {
		'run' => \&task_run
	},
	filmstock => {
		'add' => \&filmstock_add
	},
	teleconverter => {
		'add' => \&teleconverter_add
	},
	filter => {
		'add' => \&filter_add,
		'adapt' => \&filter_adapt
	},
	manufacturer => {
		'add' => \&manufacturer_add
	},
	accessory => {
		'add' => \&accessory_add,
		'list' => \&notimplemented,
		'type' => \&accessory_type
	},
	enlarger => {
		'add' => \&enlarger_add,
		'sell' => \&enlarger_sell
	},
	flash => {
		'add' => \&flash_add
	},
	battery => {
		'add' => \&battery_add
	},
	format => {
		'add' => \&format_add
	},
	negativesize => {
		'add' => \&negativesize_add
	},
	lightmeter => {
		'add' => \&lightmeter_add
	},
	process => {
		'add' => \&process_add
	},
	archive => {
		'add' => \&archive_add,
		'list' => \&notimplemented,
		'move' => \&notimplemented,
		'films' => \&archive_films
	}
);

# Read in and verify command
my $command = $ARGV[0] or &nocommand(\%handlers);
if (!exists $handlers{$command}) {
	&nocommand(\%handlers);
}

# Read in and verify subcommand
my $subcommand = $ARGV[1] or &nosubcommand(\%{$handlers{$command}}, $command);
if (!exists $handlers{$command}{$subcommand}) {
	&nosubcommand(\%{$handlers{$command}}, $command);
}

# Execute chosen handler
$handlers{$command}{$subcommand}->($db);
