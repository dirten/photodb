#!/usr/bin/perl -wT

# Interactive user interface for interacting with the photography database

use strict;
use warnings;
use Switch;
use DBI;
use DBD::mysql;
use SQL::Abstract;

use lib 'lib';
use funcs;
use queries;
use handlers;

# Connect to DB - for now this is a global
my $db = &db;

# Read in command
my $command = $ARGV[0] or &nocommand;
my $subcommand = $ARGV[1] or &nosubcommand;

# Define handlers for each command
my %handlers = (
	'film' => {
		'add' => \&film_add,
		'load' => \&film_load,
		'develop' => \&film_develop
	},
	camera => {
		'add' => \&camera_add,
		'display-lens' => \&camera_displaylens,
		'show-lenses' => \&notimplemented
	},
	negative => {
		'add' => \&negative_add,
		'bulk-add' => \&negative_bulkadd
	},
	lens => {
		'add' => \&lens_add
	},
	print => {
		'add' => \&print_add,
		'tone' => \&print_tone,
		'sell' => \&print_sell,
		'order' => \&print_order,
		'fulfil' => \&print_fulfil
	},
	paperstock => {
		'add' => \&paperstock_add
	},
	developer => {
		'add' => \&developer_add
	},
	task => {
		'run' => \&task_run
	},
	help => {
		'' => ''
	}
);

if (!exists $handlers{$command}) {
	die "Invalid command\n";
}

if (!exists $handlers{$command}{$subcommand}) {
	die "Invalid subcommand\n";
}

# Execute chosen handler
$handlers{$command}{$subcommand}->($db);
