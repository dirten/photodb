#!/usr/bin/perl -wT

# Interactive user interface for interacting with the photography database

use strict;
use warnings;
use Switch;
use DBI;
use DBD::mysql;
use SQL::Abstract;

use lib 'lib';
use funcs;
use queries;
use handlers;

# Connect to DB - for now this is a global
my $db = &db;

# Define handlers for each command
my %handlers = (
	'film' => {
		'add' => \&film_add,
		'load' => \&film_load,
		'develop' => \&film_develop,
		'tag' => \&film_tag
	},
	camera => {
		'add' => \&camera_add,
		'display-lens' => \&camera_displaylens,
		'show-lenses' => \&notimplemented,
		'sell' => \&camera_sell
	},
	negative => {
		'add' => \&negative_add,
		'bulk-add' => \&negative_bulkadd
	},
	mount => {
		'add' => \&mount_add,
		'view' => \&mount_view
	},
	lens => {
		'add' => \&lens_add,
		'sell' => \&lens_sell
	},
	print => {
		'add' => \&print_add,
		'tone' => \&print_tone,
		'sell' => \&print_sell,
		'order' => \&print_order,
		'fulfil' => \&print_fulfil
	},
	paperstock => {
		'add' => \&paperstock_add
	},
	developer => {
		'add' => \&developer_add
	},
	toner => {
		'add' => \&toner_add
	},
	task => {
		'run' => \&task_run
	},
	filmstock => {
		'add' => \&filmstock_add
	},
	teleconverter => {
		'add' => \&teleconverter_add
	},
	filter => {
		'add' => \&filter_add
	},
	manufacturer => {
		'add' => \&manufacturer_add
	}
);

# Read in and verify command
my $command = $ARGV[0] or &nocommand(\%handlers);
if (!exists $handlers{$command}) {
	&nocommand(\%handlers);
}

# Read in and verify subcommand
my $subcommand = $ARGV[1] or &nosubcommand(\%{$handlers{$command}}, $command);
if (!exists $handlers{$command}{$subcommand}) {
	&nosubcommand(\%{$handlers{$command}}, $command);
}

# Execute chosen handler
$handlers{$command}{$subcommand}->($db);
