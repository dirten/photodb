#!/usr/bin/perl -wT

# Interactive user interface for interacting with the photography database

use strict;
use warnings;
use Switch;
use DBI;
use DBD::mysql;
use SQL::Abstract;

use lib 'lib';
use funcs;
use queries;
use handlers;

# Connect to DB - for now this is a global
my $db = &db;

# Define handlers for each command
my %handlers = (
	'film' => {
		'add' => {
			'desc' => '',
			'handler' => \&film_add,
		},
		'load' => {
			'desc' => '',
			'handler' => \&film_load,
		},
		'develop' => {
			'desc' => '',
			'handler' => \&film_develop,
		},
		'tag' => {
			'desc' => '',
			'handler' => \&film_tag,
		},
		'archive' => {
			'desc' => '',
			'handler' => \&film_archive,
		},
		'locate' => {
			'desc' => '',
			'handler' => \&film_locate
		}
	},
	camera => {
		'add' => {
			'desc' => '',
			'handler' => \&camera_add,
		},
		'display-lens' => {
			'desc' => '',
			'handler' => \&camera_displaylens,
		},
		'show-lenses' => {
			'desc' => '',
			'handler' => \&notimplemented,
		},
		'sell' => {
			'desc' => '',
			'handler' => \&camera_sell,
		},
		'repair' => {
			'desc' => '',
			'handler' => \&camera_repair,
		},
		'addbodytype' => {
			'desc' => '',
			'handler' => \&camera_addbodytype
		}
	},
	negative => {
		'add' => {
			'desc' => '',
			'handler' => \&negative_add,
		},
		'bulk-add' => {
			'desc' => '',
			'handler' => \&negative_bulkadd
		}
	},
	mount => {
		'add' => {
			'desc' => '',
			'handler' => \&mount_add,
		},
		'view' => {
			'desc' => '',
			'handler' => \&mount_view,
		},
		'adapt' => {
			'desc' => '',
			'handler' => \&mount_adapt
		}
	},
	lens => {
		'add' => {
			'desc' => '',
			'handler' => \&lens_add,
		},
		'sell' => {
			'desc' => '',
			'handler' => \&lens_sell,
		},
		'repair' => {
			'desc' => '',
			'handler' => \&lens_repair
		}
	},
	print => {
		'add' => {
			'desc' => '',
			'handler' => \&print_add,
		},
		'tone' => {
			'desc' => '',
			'handler' => \&print_tone,
		},
		'sell' => {
			'desc' => '',
			'handler' => \&print_sell,
		},
		'order' => {
			'desc' => '',
			'handler' => \&print_order,
		},
		'fulfil' => {
			'desc' => '',
			'handler' => \&print_fulfil,
		},
		'archive' => {
			'desc' => '',
			'handler' => \&print_archive,
		},
		'locate' => {
			'desc' => '',
			'handler' => \&print_locate
		}
	},
	paperstock => {
		'add' => {
			'desc' => '',
			'handler' => \&paperstock_add
		}
	},
	developer => {
		'add' => {
			'desc' => '',
			'handler' => \&developer_add
		}
	},
	toner => {
		'add' => {
			'desc' => '',
			'handler' => \&toner_add
		}
	},
	task => {
		'run' => {
			'desc' => '',
			'handler' => \&task_run
		}
	},
	filmstock => {
		'add' => {
			'desc' => '',
			'handler' => \&filmstock_add
		}
	},
	teleconverter => {
		'add' => {
			'desc' => '',
			'handler' => \&teleconverter_add
		}
	},
	filter => {
		'add' => {
			'desc' => '',
			'handler' => \&filter_add,
		},
		'adapt' => {
			'desc' => '',
			'handler' => \&filter_adapt
		}
	},
	manufacturer => {
		'add' => {
			'desc' => '',
			'handler' => \&manufacturer_add
		}
	},
	accessory => {
		'add' => {
			'desc' => '',
			'handler' => \&accessory_add,
		},
		'list' => {
			'desc' => '',
			'handler' => \&notimplemented,
		},
		'type' => {
			'desc' => '',
			'handler' => \&accessory_type
		}
	},
	enlarger => {
		'add' => {
			'desc' => '',
			'handler' => \&enlarger_add,
		},
		'sell' => {
			'desc' => '',
			'handler' => \&enlarger_sell
		}
	},
	flash => {
		'add' => {
			'desc' => '',
			'handler' => \&flash_add
		}
	},
	battery => {
		'add' => {
			'desc' => '',
			'handler' => \&battery_add
		}
	},
	format => {
		'add' => {
			'desc' => '',
			'handler' => \&format_add
		}
	},
	negativesize => {
		'add' => {
			'desc' => '',
			'handler' => \&negativesize_add
		}
	},
	lightmeter => {
		'add' => {
			'desc' => '',
			'handler' => \&lightmeter_add
		}
	},
	process => {
		'add' => {
			'desc' => '',
			'handler' => \&process_add
		}
	},
	archive => {
		'add' => {
			'desc' => '',
			'handler' => \&archive_add,
		},
		'list' => {
			'desc' => '',
			'handler' => \&archive_list,
		},
		'move' => {
			'desc' => '',
			'handler' => \&archive_move,
		},
		'films' => {
			'desc' => '',
			'handler' => \&archive_films,
		},
		'seal' => {
			'desc' => '',
			'handler' => \&archive_seal,
		},
		'unseal' => {
			'desc' => '',
			'handler' => \&archive_unseal
		}
	}
);

# Read in and verify command
my $command = $ARGV[0] or &nocommand(\%handlers);
if (!exists $handlers{$command}) {
	&nocommand(\%handlers);
}

# Read in and verify subcommand
my $subcommand = $ARGV[1] or &nosubcommand(\%{$handlers{$command}}, $command);
if (!exists $handlers{$command}{$subcommand}) {
	&nosubcommand(\%{$handlers{$command}}, $command);
}

# Execute chosen handler
$handlers{$command}{$subcommand}{'handler'}->($db);
